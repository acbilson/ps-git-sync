# Purpose

A set of PowerShell scripts that allow a Git user to manage many interconnected repositories as a single repository and to keep those repositories clean when autogenerated files are created or modified but should not be committed.

# Installation

Place this readme, the GitSync.ps1 and GitClean.ps1 PowerShell scripts, and the clean.csv configuration CSV in your root folder. GitClean.ps1 is called by GitSync.ps1, so you can just use the one script for all functionality.

To further simplify, you can create an alias for GitSync and add it to your PowerShell profile. Just be aware that the alias will only work at the root directory (it'd take a little more to make it global).

`Set-Alias -Name gits -Value .\GitSync.ps1`

# Files

## GitSync.ps1

This script allows the user to execute git commands across all available repositories.

### Usage:

`.\GitSync.ps1 -Action Status`

Returns the status of all repositories. Run `.\GitSync.ps1 -Action Clean` (see below) first
to view only your changes and not the extra cruft that's created by the build process. Very useful to verify that the changes you've made in your VS project do/do not touch another repository.

`.\GitSync.ps1 -Action Branch`

Displays the local branches for each repository. Useful to see what branch you're on
for every branch and find where you may not have checked out the right branch.

`.\GitSync.ps1 -Action Branches`

Displays all remote branches that are relevant to your team. Useful to see the other branches your team have pushed. These are filtered with regex, so you may need to modify the regex to match your team's branch naming patterns. Don't forget to `.\GitSync.ps1 -Action Fetch` to update your local list of remote branches.

`.\GitSync.ps1 -Action Fetch`

Fetches the latest branch information across repositories. I use regex to strip out lengthy errors from broken branches so that new branches are more obviously reported. You may find this unnecessary and can simplify this part of the script if you'd like.

`.\GitSync.ps1 -Action Checkout -Branch [BranchName]`

Checks out the specified branch across every repo. This is most useful to synchronize all repos to a single branch to confirm there are no build errors due to branch mismatches (which happens frequently when you're on different branches per repo). Does not check out a branch that doesn't exist.

`.\GitSync.ps1 -Action Pull -Branch [BranchName]`

Checks out the specified branch, pulls the latest code from remote into that branch, then checks our your original branch (preserves current branch across repos). To use tab completion I've added our team's shared branches to the validation list - modify the list with your shared branches.

`.\GitSync.ps1 -Action Clean`

This script cleans up the extra stuff created by the build process that we cannot hide with
.gitignore or that's related to spark auto-generated files, and restores assembly version files that are part of the build process but only generate merge conflicts (have no dev value). Also removes logs from the last run.

`.\GitSync.ps1 -Action Script -Script {[do something here that happens in every repo]}`

This tool handles most circumstances, but when you need to run a command across all repos you can specify the command via the -Script tag. USE WITH EXTREME CAUTION!!! Do not run any command which makes modifications, for rolling back will be costly. If you find yourself running a command regularly with this method, consider adding it to one of this script's default actions instead.

## GitClean.ps1

I have kept the logic in its own script, but GitSync.ps1 runs this script for `.\GitSync.ps1 -Action Clean` so it is not necessary to call directly.

### Usage

To use the GitClean.ps1 script you must add a clean.csv file with rows for every main repository folder and the subfolder or file to be removed. You may also specify 'NULL' for main repositories that you want the script to run within but when you do not have any file or folder to remove.

The file should have the following header:

BaseFolder,RelativePath

Example CSV:

BaseFolder,RelativePath
GitRepo,"Path/To/Folder"
GitRepo,"Path/To/File.txt"

Apart from the removal of files and folders, this script also restores a specific set of files which are automatically updated on every build but should not be committed (if they were, you'd have constant merge conflicts).